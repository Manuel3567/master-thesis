# Analysis

### Penmanshiel Turbine

Data enrichment
- aim is to ammend the data file with information about the operation status of the turbine
- Step 1 creates a virtual status file with 10 minute intervals and 2 columns, "Status" and "Events"
- The values of the Status column is given by the values of the Status column 4. of the status file: Stop is mapped to Stop and Informational, Warning is mapped to running
- That is whenever the turbine was in stopped mode the Status of the corresponding interval is set to Stop
- These time intervals will have to be neglected in the time intervals.
- The "Events" column is a concatenation of 4 variables from the status file: "Status", "Message", "Service contract category" and "IEC category" separated by a dash
- "Lost Production to Downtime and Curtailment Total (kWh)" is a useful variable v:
    - v ranges from 0 to about 300
    - v = 0 <=> most entries have Status = Running but there are 1289 entries with Status = "Stop"
    - v != 0 <=> Status = Stop

Analysis of all entries with status "Running": 
- The 2016 dataset starts in the middle of 2016. In total there are 18,346 entries, roughly half a year * 24 * 6 entries per hour. 
- The turbine was installed in the middle of June and data started to be collected from June 24th onwards
- However the turbine was not active until end of August.
- This explains the majority 7781 of the 9074 "Stop" entries where the turbine is not in productive operation.
- There are 18346 entries with Status "Running". This is to investigate which of these should be kept. There exists 34 different values of the variable "Events" (combinations of the original columns: "Status", "Message", "Service contract category" and "IEC category")
- One value of "Events" has the most entries 11,578 ("Informational - System OK - System OK (32) - Full Performance"). Such data entries will be kept in any case.
- The second biggest event with 5,615 entries is "Warning - P output externally reduced - Warnings (27) - Partial Performance"
- Other analyses like Capelletti 2024 use only the data file and do not merge with the status file. In their analysis they exclude all events where the variable v is non zero. However, closer inspection shows that also entries with v = 0 have Status Stop and should be excluded. On the other hand, where the status file indicates "Warning - P output externally reduced - Warnings (27) - Partial performance" should be included in the analysis because we consider the electric power that is generated by the turbine and not the electric power that is transmitted to the external grid.
- **All other events are small in number and will be neglected because of messages that indicate non full operation e.g. "External Stop (low wind speed)",
"Error brake resistor CHP", "SNTP error", "Parametrized P red."**

Analysis of 1st "Events": Status "Running", event: "Informational - System OK - System OK (32) - Full Performance"
- 2221 entries with negative power (kW)
- Those (negative power entries) all have wind speeds less than 4.2 (m/s)
- For wind speeds below 3 power is negative
- For wind speeds between 3-4 power can be positive or negative
- From wind speeds of 5 m/s onwards power is only positive
- The data follows the theoretical power vs wind speed curve pretty well. There are deviations for example
    - 2016-11-05 01.00 Wind Speed of 19.4 m/s 1742 kW, 10 minutes later wind speed 21.1 m/s 1741 kW
    - At this wind speed one would expect a power of 2000 kW. Could be due to the change in wind direction of 347° to 355° but the nacelle position was not adjusted, remained at 347

Analysis of 2nd "Events": "Warning - P output externally reduced - Warnings (27) - Partial performance"
- 5615 entries
- Difference to "Full Performance" is "Lost production" != 0 or "Production-based IEC B.2.3 != 1"
- This seems to indicate that the power transferred to the grid is reduced but the power produced by the turbine is not affected



### Turbinendatensatz Pennmanshiel

Split:
- Train: 01.08.2016 - 30-06.2019
- Validation: 01.07.2019 - 30.06.2020
- Test: 01.07.2020 - 30.06.2021




### Forecast data
- Aim: compare one-day forecast wind speed against actual wind speed for the time range available from open meteo (3 months) 
- Selection:
   - Latitude: 55,904990, Longitude: -2.291806
   - Forecast days: 1 day
   - Past days: 3 months
   - Hourly Weather Variables: blank
   - Wind on 80, 120, 180 metre: "Wind Speed (80m) for Day 0, 1, 2
   - Weather models: "Best match"
   - Settings: Wind Speed Unit: "m/s"
   - Url: https://previous-runs-api.open-meteo.com/v1/forecast?latitude=55.90499&longitude=-2.291806&hourly=wind_speed_80m,wind_speed_80m_previous_day1,wind_speed_80m_previous_day2&wind_speed_unit=ms&past_days=92&forecast_days=1&temporal_resolution=native&models=best_match
- The variable "Forecast days" gives the time horizon in the future that is days following the time when the query is run.
- The field "Time Interval" allows for data ranges above the 3 months max time interval



When running the following data is returned:
- 55.90° latitude, -2.30 Longitude, 194m above sea level
- Can also be run for 15 minute intervals by replacing the string "hourly" with "minutely_15"
   - url: https://previous-runs-api.open-meteo.com/v1/forecast?latitude=55.90499&longitude=-2.291806&minutely_15=wind_speed_80m,wind_speed_80m_previous_day1,wind_speed_80m_previous_day2&wind_speed_unit=ms&past_days=92&forecast_days=1&temporal_resolution=native&models=best_match



When selecting:
   - Latitude: 55,904990, Longitude: -2.291806
   - Time Interval 2018-01-01 - 2018-01-02
   - Hourly Weather variables: "Wind Speed (10 m)"
   - Weather models: "JMA Seamless"

When running the following data is returned:
- latitude":56.0,"longitude":-2.5
- Time intervals: only 6h

I get hourly wind speed data, 15 minute-intervals are available as well:
https://previous-runs-api.open-meteo.com/v1/forecast?latitude=55.90499&longitude=-2.291806&minutely_15=wind_speed_10m_previous_day1&wind_speed_unit=ms&temporal_resolution=native&start_date=2018-01-01&end_date=2018-01-02&models=jma_seamless


Problem: 15 minute time interval not available:

compare weather forecast at geocentric mean of 50Hertz for the longest time period available (3 months) with
actual data from open-meteos historical weather api

1. historical 1-day forecast
query
- Latitude: 53, Longitude: 13.125
- Timezone: Not set (GMT +0)
- Forecast days: 1 Day
- Past days: 3 months
- Hourly weather variables:
   - Wind Speed (10m) Day 0, Day 1
- Additional Options
   - Native model resolution
   - Terrain optimized, Prefers Land
- Wind on 80, 120 and 180 metre
   - Wind Speed (80m, 120m, 180m) for Day 0 and Day 1 each
- Weather models: DWD ICON D2
- Settings: Celsius °C, Wind Speed Unit: m/s, Precipitation Unit: Milimeter, Timeformat: ISO 8601 (e.g. 2022-12-31)

returns
- {"latitude":53.0,"longitude":13.119999,"generationtime_ms":2.7229785919189453,"utc_offset_seconds":0,"timezone":"GMT","timezone_abbreviation":"GMT","elevation":89.0,"hourly_units":{"time":"iso8601","wind_speed_10m":"m/s","wind_speed_10m_previous_day1":"m/s","wind_speed_80m":"m/s","wind_speed_80m_previous_day1":"m/s","wind_speed_120m":"m/s","wind_speed_120m_previous_day1":"m/s","wind_speed_180m":"m/s","wind_speed_180m_previous_day1":"m/s"},"hourly":{"time":["2024-08-21T00:00" - "2024-11-21T23:00"]}
- [url](https://previous-runs-api.open-meteo.com/v1/forecast?latitude=53&longitude=13.125&hourly=wind_speed_10m,wind_speed_10m_previous_day1,wind_speed_80m,wind_speed_80m_previous_day1,wind_speed_120m,wind_speed_120m_previous_day1,wind_speed_180m,wind_speed_180m_previous_day1&wind_speed_unit=ms&past_days=92&forecast_days=1&temporal_resolution=native&models=icon_d2)


2. historical weather API open meteo
query
- Latitude: 53, Longitude: 13.125
- Timezone: Not set (GMT +0)
- Start Date: 2024-08-21
- End Date: 2024-11-21
- Hourly weather variables:
   - Wind Speed (10m), Wind Speed (100 m)
- Additional Options
   - Temporal Resolution for Hourly Data: 1 hourly
   - Terrain optimized, Prefers Land
- Settings: Celsius °C, Wind Speed Unit: m/s, Precipitation Unit: Milimeter, Timeformat: ISO 8601 (e.g. 2022-12-31)

returns
- {"latitude":52.97012,"longitude":13.050848,"generationtime_ms":0.41794776916503906,"utc_offset_seconds":0,"timezone":"GMT","timezone_abbreviation":"GMT","elevation":71.0,"hourly_units":{"time":"iso8601","wind_speed_10m":"m/s","wind_speed_100m":"m/s"},"hourly":{"time":["2024-08-21T00:00" - "2024-11-21T23:00"]}


return different locations, so after trying to find a location
where both the historical weather and forecast return the same
coordinates I find that it works for coordinates
latitude: 51, longitude: 12.88


1. historical 1-day forecast
query:
- Latitude: 51, Longitude: 12.88
- Timezone: Not set (GMT +0)
- Forecast days: 1 Day
- Past days: 3 months
- Hourly weather variables:
   - Wind Speed (10m) Day 0, Day 1
- Additional Options
   - Native model resolution
   - Terrain optimized, Prefers Land
- Wind on 80, 120 and 180 metre
   - Wind Speed (80m, 120m, 180m) for Day 0 and Day 1 each
- Weather models: DWD ICON D2
- Settings: Celsius °C, Wind Speed Unit: m/s, Precipitation Unit: Milimeter, Timeformat: ISO 8601 (e.g. 2022-12-31)

- returns
{"latitude":51.0,"longitude":12.879999,"generationtime_ms":2.757906913757324,"utc_offset_seconds":0,"timezone":"GMT","timezone_abbreviation":"GMT","elevation":250.0,"hourly_units":{"time":"iso8601","wind_speed_10m":"m/s","wind_speed_10m_previous_day1":"m/s","wind_speed_80m":"m/s","wind_speed_80m_previous_day1":"m/s","wind_speed_120m":"m/s","wind_speed_120m_previous_day1":"m/s","wind_speed_180m":"m/s","wind_speed_180m_previous_day1":"m/s"},"hourly":{"time":["2024-08-21T00:00" - "2024-11-21T23:00"]}
- url: https://previous-runs-api.open-meteo.com/v1/forecast?latitude=51&longitude=12.88&hourly=wind_speed_10m,wind_speed_10m_previous_day1,wind_speed_80m,wind_speed_80m_previous_day1,wind_speed_120m,wind_speed_120m_previous_day1,wind_speed_180m,wind_speed_180m_previous_day1&wind_speed_unit=ms&past_days=92&forecast_days=1&temporal_resolution=native&models=icon_d2

2. historical weather API open meteo
query
- Latitude: 51, Longitude: 12.96
- Timezone: Not set (GMT +0)
- Start Date: 2024-08-21
- End Date: 2024-11-21
- Hourly weather variables:
   - Wind Speed (10m), Wind Speed (100m)
- Additional Variables and Options
   - Temporal Resolution for Hourly Data: 1 hourly
   - Terrain optimized, Prefers Land
- Settings: Celsius °C, Wind Speed Unit: m/s, Precipitation Unit: Milimeter, Timeformat: ISO 8601 (e.g. 2022-12-31)

returns
{"latitude":51.001755,"longitude":12.880143,"generationtime_ms":0.370025634765625,"utc_offset_seconds":0,"timezone":"GMT","timezone_abbreviation":"GMT","elevation":314.0,"hourly_units":{"time":"iso8601","wind_speed_10m":"m/s","wind_speed_100m":"m/s"},"hourly":{"time":["2024-08-21T00:00" - "2024-11-21T23:00"]}
- url: https://archive-api.open-meteo.com/v1/archive?latitude=51&longitude=12.96&start_date=2024-08-21&end_date=2024-11-21&hourly=wind_speed_10m,wind_speed_100m&wind_speed_unit=ms


3. Historical Forecast API

works (hourly):
- https://historical-forecast-api.open-meteo.com/v1/forecast?latitude=52.52&longitude=13.41&start_date=2021-08-01&end_date=2021-08-01&hourly=wind_speed_10m&wind_speed_unit=ms


- https://historical-forecast-api.open-meteo.com/v1/forecast?latitude=55.904990&longitude=-2.29&start_date=2021-08-01&end_date=2021-08-01&hourly=wind_speed_10m&wind_speed_unit=ms

works (15-minutely)
- https://historical-forecast-api.open-meteo.com/v1/forecast?latitude=55.904990&longitude=-2.29&start_date=2021-08-01&end_date=2021-08-01&minutely_15=wind_speed_10m&wind_speed_unit=ms
returns location: latitude":55.9,"longitude":-2.2800002

- https://historical-forecast-api.open-meteo.com/v1/forecast?latitude=55.904990&longitude=-2.291&start_date=2021-08-01&end_date=2021-08-01&minutely_15=wind_speed_10m&wind_speed_unit=ms
returns location: latitude":55.9,"longitude":-2.3000002 

- https://historical-forecast-api.open-meteo.com/v1/forecast?latitude=55.904990&longitude=-2.291&start_date=2021-03-23&end_date=2021-03-23&minutely_15=wind_speed_10m&wind_speed_unit=ms
returns location: latitude":55.9,"longitude":-2.3000002

NCEP HRRR U.S. Conus although according to documentation is available since 2018-01-01 no results for location latitude: 55.9, longitude: -2.3000002 (https://open-meteo.com/en/docs/historical-forecast-api#start_date=2021-03-23&end_date=2021-03-23&hourly=wind_speed_10m&wind_speed_unit=ms&models=gfs_hrrr)

- model "JMA GSM" goes back to 2016 even for a location close to Pennmanshiel but only has a native resolution of 6 hours.
https://historical-forecast-api.open-meteo.com/v1/forecast?latitude=55.90499&longitude=-2.291806&start_date=2016-01-01&end_date=2016-01-02&hourly=wind_speed_10m&wind_speed_unit=ms&temporal_resolution=native&models=jma_gsm
returns location: latitude":56.0,"longitude":-2.5

api costs for 2016-01-01 - 2024-11-30 = 46.5

- model "JMA GSM" can be obtained 15-minutely against its native resolution (interpolated then?)
https://historical-forecast-api.open-meteo.com/v1/forecast?latitude=55.85&longitude=-2.4&start_date=2016-01-01&end_date=2016-01-02&minutely_15=wind_speed_10m&wind_speed_unit=ms&models=jma_gsm 
returns location: latitude":56.0,"longitude":-2.5


## - Meeting: 22.11.2024 Vorschlag: Evaluation mit historischen prognosen und Prognosenfehler dann interpretieren

Get 4 locations close to Pennmanshiel Turbine 09 location and compare the differences in Forecast values

1. latitude: 55.92,"longitude:-2.30: data\weather_forecast\raw\open-meteo-latitude_55.92_longitude_-2.30W103m_Historical_Forecast_API.csv
2. latitude: 55.92, longitude: -2.26: data\weather_forecast\raw\open-meteo-latitude_55.92_longitude_-2.26W178m_Historical_Forecast_API.csv
3. latitude: 55.90, longitude: -2.30: data\weather_forecast\raw\open-meteo-latitude_55.90_longitude_-2.30W210m_Historical_Forecast_API.csv
4. Latitude: 55.90, Longitude: -2.26: data\weather_forecast\raw\open-meteo-latitude_55.9_longitude_-2.26W213m_Histoorical_Forecast_API.csv


### 1. query:
- Latitude: 55.92
- Longitude: -2.30
- Timezone: Not set (GMT + 0)
- Start Date: 2021-08-01
- End Date: 2024-11-01
- Weather models: Best match
- 15-Minutely Weather variables: Wind Speed (80 m)
- Settings: Temperature Unit: Celsius °C, Wind Speed Unit: m/s, Precipitation Unit: Milimeter, Timeformat: ISO 8601 (e.g. 2022-12-31)

url: https://historical-forecast-api.open-meteo.com/v1/forecast?latitude=55.92&longitude=-2.3&start_date=2021-08-01&end_date=2024-11-01&minutely_15=wind_speed_80m&wind_speed_unit=ms&models=best_match

returns 
- location: latitude:55.92,longitude:-2.30
- elevation: 103m above sea level

### 2. query:
- Latitude: 55.92
- Longitude: -2.26
- Timezone: Not set (GMT + 0)
- Start Date: 2021-08-01
- End Date: 2024-11-01
- Weather models: Best match
- 15-Minutely Weather variables: Wind Speed (80 m)
- Settings: Temperature Unit: Celsius °C, Wind Speed Unit: m/s, Precipitation Unit: Milimeter, Timeformat: ISO 8601 (e.g. 2022-12-31)
url: https://historical-forecast-api.open-meteo.com/v1/forecast?latitude=55.92&longitude=-2.26&start_date=2021-08-01&end_date=2024-11-01&minutely_15=wind_speed_80m&wind_speed_unit=ms&models=best_match

returns
- location: latitude: 55.92, longitude: -2.26
- elevation: 178m above sea level

### 3. query:
- Latitude: 55.90
- Longitude: -2.30
- Timezone: Not set (GMT + 0)
- Start Date: 2021-08-01
- End Date: 2024-11-01
- Weather models: Best match
- 15-Minutely Weather variables: Wind Speed (80 m)
- Settings: Temperature Unit: Celsius °C, Wind Speed Unit: m/s, Precipitation Unit: Milimeter, Timeformat: ISO 8601 (e.g. 2022-12-31)
url: https://historical-forecast-api.open-meteo.com/v1/forecast?latitude=55.9&longitude=-2.3&start_date=2021-08-01&end_date=2024-11-01&minutely_15=wind_speed_80m&wind_speed_unit=ms&models=best_match

returns:
- location: latitude: 55.90, longitude: -2.30
- elevation: 210m above sea level


### 4. query
- Latitude: 55.90
- Longitude: -2.26
- Timezone: Not set (GMT + 0)
- Start Date: 2021-08-01
- End Date: 2024-11-01
- Weather models: Best match
- 15-Minutely Weather variables: Wind Speed (80 m)
- Settings: Temperature Unit: Celsius °C, Wind Speed Unit: m/s, Precipitation Unit: Milimeter, Timeformat: ISO 8601 (e.g. 2022-12-31)
url: https://historical-forecast-api.open-meteo.com/v1/forecast?latitude=55.9&longitude=-2.26&start_date=2021-08-01&end_date=2024-11-01&minutely_15=wind_speed_80m&wind_speed_unit=ms&models=best_match

returns:
- location: Latitude: 55.90, longitude: -2.26
- elevation: 213m above sea level
















### How big is the difference between d0 forecasts from the closest point available at turbine 09 at Pennmanshiel compared to the measured SCADA data

### query 3. from above with start date and end date adjusted to match the time period of Pennmanshiel dataset:
- start date: 2016-06-24
- end date: 2021-06-30
url
https://historical-forecast-api.open-meteo.com/v1/forecast?latitude=55.9&longitude=-2.3&start_date=2016-06-24&end_date=2021-06-30&minutely_15=wind_speed_80m&wind_speed_unit=ms&models=best_match


Problem: historical weather forecasts (d0) are not available for the time period of the Pennmanshiel turbine

What is available:
- Model: "NCEP GFS Seamless" gives wind speed at 80m in 1 hour resolution from 23.03.2021 onwards
- location returned: Latitude: 55.82, Longitude: -2.46
. Also returns location: Latitude 55.82, Longitude: -2.34
Also Latitude: 55,82, Longitude: -2.11
Also Latitude: 55.82, Longitude: -2.23

Conclusion: spatial resolution is 0.11° about 13km

The 2 closest Latitudes to Pennmanshiel are 56.06 or **55,82**
For longitude: **-2.34** or -2.23

- Data on turbine 09:
   - latitude: 55.904990
   - longitude: -2.291806




### 50Hertz
- Sanity Check: 
   - ~~schauen, dass keine NaN Werte enthalten: Warten, bis 2024 verfügbar und dann alle 2024 holen~~
   - ~~Werte, die geliefert werden zwischen 0 und der von 50Hertz installierten Power ist~~
   - ~~keine Werte fehlen~~
- Training, Test split
   - ~~1 Jahr validation: 2023~~
   - ~~1 Jahr Test: 2024~~ (momentan noch unvollständig)
   - ~~Rest Training: 2016-2022~~
- Daten umwandeln (pro column ein Time interval)

- Trainingsdaten fitte Normalverteilung für jedes Zeitintervall (delta_P)
- Schaue wie die mus & sigmas vom Zeitintervall abhängen
- Validation dataset predicted.




